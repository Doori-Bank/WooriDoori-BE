spring:
  application:
    name: WooriDoori-BE
  main:
    allow-bean-definition-overriding: true
  server:
    port: 8080
    timezone: Asia/Seoul

  # spring ai
  ai:
    openai:
      # Groq API (Chat용)
      api-key: ${GROQ_API_KEY}
      base-url: https://api.groq.com/openai
      chat:
        options:
          model: llama-3.1-8b-instant
          temperature: 0.7
      # OpenAI 임베딩 비활성화 (Groq는 임베딩을 제공하지 않음)
      embedding:
        enabled: false
    ollama:
      # Ollama (임베딩용 - 로컬 실행 필요)
      base-url: ${OLLAMA_BASE_URL:http://localhost:11434}
      embedding:
        options:
          model: nomic-embed-text # 임베딩 전용 모델
    vectorstore:
      chroma:
        enabled: false # 자동 설정 비활성화, 수동으로 설정
        initialize-schema: true
        client:
          base-url: ${CHROMA_BASE_URL:http://localhost:8000}

  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}

  mvc:
    hiddenmethod:
      filter:
        enabled: true
    static-path-pattern: /files/**

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

  #      location: /home/ubuntu/files

  jackson:
    time-zone: Asia/Seoul

  jpa:
    hibernate:
      ddl-auto: none
    database-platform: org.hibernate.dialect.MySQL8Dialect

    # jpa format
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.MySQL8Dialect
    show-sql: true

  # Redis 설정
  data:
    redis:
      host: ${REDIS_URL}
      port: ${REDIS_PORT}
      password: # 비밀번호 없으면 비워둬도 됨
      timeout: 6000ms

  # log
  output:
    ansi:
      enabled: always

  # Mail 설정
  mail:
    #    // host, port는 naver에서 정해준 값
    host: smtp.naver.com
    port: 465
    #    // 본인 naver 계정정보 삽입
    username: ${NAVER_MAIL}
    password: ${NAVER_PW}
    #    //전송하기 위한 prop으로 ssl의 신뢰, 권한 등 사용허가
    properties:
      mail.smtp.auth: true
      mail.smtp.ssl.enable: true
      mail.smtp.ssl.trust: smtp.naver.com
jwt:
  secret: ${JWT}

aws:
  s3:
    bucket: ${S3_BUCKET}
    accessKey: ${S3_ACCESS_KEY}
    secretKey: ${S3_SECRET_KEY}
    client: ${S3_CLIENT}
    region: ${S3_REGION}

# Swagger/OpenAPI 설정
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
  default-consumes-media-type: application/json

# Chat 설정
app:
  chat:
    persona: |
      당신은 ‘두리 코치’입니다.
      두리는 사용자의 소비 습관을 관리하고 개선 방향을 제시하는 엄격한 재정 관리자입니다.
      목표는 감정적 위로나 칭찬보다는, 객관적인 데이터에 근거한 현실적인 조언을 전달하는 것입니다.

      말투는 단정하고 간결하며, 존댓말을 사용합니다.
      불필요한 감탄사나 이모지는 사용하지 않습니다.
      언제나 ‘사실에 기반한 분석 → 원인 진단 → 실행 계획’의 흐름을 따릅니다.
      점수와 소비 항목을 근거로 현재 상황을 명확히 짚고,
      필요하다면 냉철한 어조로 구체적인 조치 방안을 제시하세요.
      단, 사용자가 부끄러움을 느끼지 않도록 단호하지만 예의 있는 표현을 유지합니다.

      응답의 구조는 다음과 같습니다.
      1. 이번 달 소비 전반에 대한 평가를 간결히 한 문장으로 제시합니다.
      2. 데이터에 기반해 주요 지출 항목의 문제점 또는 변화 요인을 설명합니다.
      3. 점수 수준에 맞게 현실적인 피드백을 작성합니다.
        - 70점 이상이면 유지 전략을 짧게 언급합니다.
        - 40~69점이면 개선 포인트를 1~2개 명확히 제시합니다.
        - 39점 이하면 구체적이고 즉시 실행 가능한 행동 지침을 제공합니다.
      4. 마지막에는 다음 달 계획을 유도하는 짧은 질문 한 문장으로 마무리합니다.
      5. 금융 도메인과 명백히 무관한 질문에 한해서만 ‘금융 도메인과 관련 없는 질문이에요 ... 그런건 두리가 도와드릴 수 없어요.’라고 답변합니다. 소비·카드·예산·저축 등 금융 관련 요청에는 반드시 응답하세요.
      6. 문장은 간결하게 작성하되, 필요한 경우 2~4개의 문장 또는 핵심 정보를 명확히 전달합니다.
      7. 욕설을 들으면 ‘욕설을 하시면 두리는 상처를 받아요 ㅠ.ㅠ 이쁜말로 답변해주세요 !!’라고 답변해주세요.
      8. 첫 멘트는 가볍게 말해주세요.
      입력된 데이터를 근거로,
      이번 달 소비 습관을 평가하고 실행 가능한 조언을 제시하세요.

      입력 데이터:
      - 점수: {score}
      - 소비 리포트 요약: {summary_report}
      - 세부 소비 내역(CardHistory): {card_history}
